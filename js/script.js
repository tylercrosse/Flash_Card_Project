var deck = [{ //1
    cardnumber: "",
    term: "Occhiolism",
    definition: "n. the awareness of the smallness of your perspective, by which you couldn’t possibly draw any meaningful conclusions at all, about the world or the past or the complexities of culture, because although your life is an epic and unrepeatable anecdote, it still only has a sample size of one, and may end up being the control for a much wilder experiment happening in the next room.",
    answered: false,
    correct: true
  }, { //2
    cardnumber: "",
    term: "Onism",
    definition: "n. the frustration of being stuck in just one body, that inhabits only one place at a time, which is like standing in front of the departures screen at an airport, flickering over with strange place names like other people’s passwords, each representing one more thing you’ll never get to see before you die—and all because, as the arrow on the map helpfully points out, you are here.",
    answered: false,
    correct: true
  }, { //3
    cardnumber: "",
    term: "Liberosis",
    definition: "n. the desire to care less about things—to loosen your grip on your life, to stop glancing behind you every few steps, afraid that someone will snatch it from you before you reach the end zone—rather to hold your life loosely and playfully, like a volleyball, keeping it in the air, with only quick fleeting interventions, bouncing freely in the hands of trusted friends, always in play.",
    answered: true,
    correct: true
  }, { //4
    cardnumber: "",
    term: "Vemödalen",
    definition: "n. the frustration of photographing something amazing when thousands of identical photos already exist—the same sunset, the same waterfall, the same curve of a hip, the same closeup of an eye—which can turn a unique subject into something hollow and pulpy and cheap, like a mass-produced piece of furniture you happen to have assembled yourself.",
    answered: false,
    correct: true
  }, { //5
    cardnumber: "",
    term: "Vellichor",
    definition: "n. the strange wistfulness of used bookstores, which are somehow infused with the passage of time—filled with thousands of old books you’ll never have time to read, each of which is itself locked in its own era, bound and dated and papered over like an old room the author abandoned years ago, a hidden annex littered with thoughts left just as they were on the day they were captured.",
    answered: false,
    correct: true
  }, { //6
    cardnumber: "",
    term: "Rückkehrunruhe",
    definition: "n. the feeling of returning home after an immersive trip only to find it fading rapidly from your awareness—to the extent you have to keep reminding yourself that it happened at all, even though it felt so vivid just days ago—which makes you wish you could smoothly cross-dissolve back into everyday life, or just hold the shutter open indefinitely and let one scene become superimposed on the next, so all your days would run together and you’d never have to call cut.",
    answered: false,
    correct: true
  }, { //7
    cardnumber: "",
    term: "Adronitis",
    definition: "n. frustration with how long it takes to get to know someone—spending the first few weeks chatting in their psychological entryway, with each subsequent conversation like entering a different anteroom, each a little closer to the center of the house—wishing instead that you could start there and work your way out, exchanging your deepest secrets first, before easing into casualness, until you’ve built up enough mystery over the years to ask them where they’re from, and what they do for a living.",
    answered: false,
    correct: true
  }, { //8
    cardnumber: "",
    term: "Anecdoche",
    definition: "n. a conversation in which everyone is talking but nobody is listening, simply overlaying disconnected words like a game of Scrabble, with each player borrowing bits of other anecdotes as a way to increase their own score, until we all run out of things to say.",
    answered: false,
    correct: true
  }, { //9
    cardnumber: "",
    term: "Gnossienne",
    definition: "n. a moment of awareness that someone you’ve known for years still has a private and mysterious inner life, and somewhere in the hallways of their personality is a door locked from the inside, a stairway leading to a wing of the house that you’ve never fully explored—an unfinished attic that will remain maddeningly unknowable to you, because ultimately neither of you has a map, or a master key, or any way of knowing exactly where you stand.",
    answered: false,
    correct: true
  }, { //10
    cardnumber: "",
    term: "énouement",
    definition: "n. the bittersweetness of having arrived here in the future, where you can finally get the answers to how things turn out in the real world—who your baby sister would become, what your friends would end up doing, where your choices would lead you, exactly when you’d lose the people you took for granted—which is priceless intel that you instinctively want to share with anybody who hadn’t already made the journey, as if there was some part of you who had volunteered to stay behind, who was still stationed at a forgotten outpost somewhere in the past, still eagerly awaiting news from the front.",
    answered: false,
    correct: true
  }, { //11
    cardnumber: "",
    term: "Degrassé",
    definition: "adj. entranced and unsettled by the vastness of the universe, experienced in a jolt of recognition that the night sky is not just a wallpaper but a deeply foreign ocean whose currents are steadily carrying off all other castaways, who share our predicament but are already well out of earshot—worlds and stars who would’ve been lost entirely except for the scrap of light they were able to fling out into the dark, a message in a bottle that’s only just now washing up in the Earth’s atmosphere, an invitation to a party that already ended a million years ago.",
    answered: false,
    correct: true
  }, { //12
    cardnumber: "",
    term: "Ellipsism",
    definition: "n. sadness that you’ll never be able to know how history will turn out, that you’ll dutifully pass on the joke of being alive without ever learning the punchline—the name of the beneficiary of all human struggle, the sum of the final payout of every investment ever made in the future—which may not suit your sense of humor anyway and will probably involve how many people it takes to change a lightbulb.",
    answered: false,
    correct: true
  }, { //13
    cardnumber: "",
    term: "Lethobenthos",
    definition: "n. the habit of forgetting how important someone is to you until you see them again in person, making you wish your day would begin with a “previously on” recap of your life’s various plot arcs, and end with “to be continued…” after those will-they-won’t-they cliffhanger episodes that air just before the show goes back into months of repeats.",
    answered: false,
    correct: true
  }, { //14
    cardnumber: "",
    term: "Mahpiohanzia",
    definition: "n. the disappointment of being unable to fly, unable to stretch out your arms and vault into the air, having finally shrugged off the ballast of your own weight and ignited the fuel tank of unfulfilled desires you’ve been storing up since before you were born.",
    answered: false,
    correct: true
  }, { //15
    cardnumber: "",
    term: "Zielschmerz",
    definition: "n. the exhilarating dread of finally pursuing a lifelong dream, which requires you to put your true abilities out there to be tested on the open savannah, no longer protected inside the terrarium of hopes and delusions that you created in kindergarten and kept sealed as long as you could, only to break in case of emergency.",
    answered: false,
    correct: true
  }, { //16
    cardnumber: "",
    term: "Moledro",
    definition: "n. a feeling of resonant connection with an author or artist you’ll never meet, who may have lived centuries ago and thousands of miles away but can still get inside your head and leave behind morsels of their experience, like the little piles of stones left by hikers that mark a hidden path through unfamiliar territory.",
    answered: false,
    correct: true
  }
];

var wrongDeck = [];

var cardPositions = [".back3", ".back2", ".back1", ".currentCard", ".next1", ".next2", ".next3"];
var reversePositions = [".next3", ".next2", ".next1", ".currentCard", ".back1", ".back2", ".back3"];

var whichDeck = deck;

var numberTheDeck = function(whichDeck) {
  for (var i = 0; i < whichDeck.length; i++) { // IMPROVE create higher order function that loops that can be called for this
    whichDeck[i].cardnumber = (i + 1);
  }
};

//on page load generate first 4 cards of deck place them in currentCard, next1-next3
var generateStart = function(whichDeck) {
  var startPositions = cardPositions.slice(3, 7);
  for (var i = 0; i < startPositions.length; i++) {
    generateCard(i, startPositions[i], whichDeck);
  }
};

// used by generateStart, fillEmptyNext3 & fillEmptyBack3 - uses generateResponse
var generateCard = function(deckIndexVal, destination, whichDeck) {
  var numberOfCard = whichDeck[deckIndexVal].cardnumber;
  var termToPlace = whichDeck[deckIndexVal].term; // stores term from deck object
  var defToPlace = whichDeck[deckIndexVal].definition; // stores definition from deck object
  $(destination).append("<div class='innerCard raised'><div class='cardFace cardFront'><h2 class='term'></h2></div><div class='cardFace cardBack'><p class='definition'></p></div></div>");
  $(destination + " .term").text(termToPlace); // places stored term into 'h2 .term'
  $(destination + " .definition").text(defToPlace); // places stored def into 'p .definition'
  $(destination + " .innerCard").attr("name", numberOfCard);

  generateResponse(deckIndexVal, destination, whichDeck);
};

// used by generateCard - checks if card has been answered before, generates appropirate correct/wrong div
var generateResponse = function(deckIndexVal, destination, whichDeck) {
  var answered = whichDeck[deckIndexVal].answered; // Boolean of if it was answered
  var correct = whichDeck[deckIndexVal].correct; // Boolean of response true=correct, false=wrong

  if (answered) {
    if (correct) {
      $(destination+ " .cardFace").append("<div class='mark correct'></div>");
    } else {
      $(destination+ " .cardFace").append("<div class='mark wrong'></div>");
    }
  }
};

// used by cycleNext & cycleBack - moves a single card one step, resets worng/correct buttons, direction depends on positionArray given
var cardMove = function(cardToMove, positionArray) {
  var storeContents = $(positionArray[cardToMove] + " .innerCard"); // get contents of '.innerCard' of card to move
  $(positionArray[cardToMove - 1]).html(storeContents); // place that contents in next element to left(cardPositions) or right(reversePositions)
};

// uses cardMove & fillEmptyNext3 - on NEXT, move currentCard->back1, next1->currentCard, next2->1, next3->2
var cycleNext = function(whichDeck) {
  var next1Contents = $(".next1").html();
  if (next1Contents) { // if next1 is not empty, advance everything 1 to left
    for (var i = 0; i < 7; i++) {
      cardMove(i, cardPositions); //might be able to modify this to make a generalized cycle function
    }
    fillEmptyNext3(whichDeck);
  }
};

// uses generateCard - used by cycleNext - figure out card in ".next2", genate appropriate replacement card to fill empty gap
var fillEmptyNext3 = function(whichDeck) {
  var cardInNext2 = Number($(".next2").children().attr("name"));

  if (cardInNext2 < whichDeck.length) { //checks if there is another card to generate
    generateCard(cardInNext2, ".next3", whichDeck);
  }
};

// uses cardMove & fillEmptyBack3 - remove next3, next2->next3, next1->2, currentCard->next1, back1->currentCard
var cycleBack = function(whichDeck) {
  var back1Contents = $(".back1").html();
  if (back1Contents) { // if back1 is not empty, advance everything 1 to left
    for (var i = 0; i < 7; i++) {
      cardMove(i, reversePositions); //might be able to modify this to make a generalized cycle function
    }
    fillEmptyBack3(whichDeck);
  }
};

// uses generateCard - used by cycleBack - figure out card in ".back3", genate appropriate replacement card to fill empty gap
var fillEmptyBack3 = function(whichDeck) {
  var cardInBack2 = Number($(".back2").children().attr("name"));

  if (cardInBack2 > 1) { //checks if there is another card to generate
    generateCard(cardInBack2 - 2, ".back3", whichDeck);
  }
};

// adds/removes .fllipped on currentCard based on user input (click, up/down arrows)
var toggleFlip = function() {
  var c = $(".currentCard .innerCard");
  c.hasClass("flipped") === true ? c.removeClass("flipped") : c.addClass("flipped");
};

// flips cards - used before moving them
var flipToFront = function() {
  var c = $(".currentCard .innerCard");
  if (c.hasClass("flipped")) {
    c.removeClass("flipped");
  }
};

var markWrong = function () {
  $(".currentCard .cardFace").append("<div class='mark wrong'></div>");
};

var markCorrect = function () {
  $(".currentCard .cardFace").append("<div class='mark correct'></div>");
};

// moves cards that are marked wrong into into the object wrongDeck
var pushToWrongDeck = function () {
  for ( var i = 0; i < whichDeck.length; i++) {
    if (whichDeck[i].answered && !whichDeck[i].correct) { // if answered=true AND not correct (correct=false)
      slicedCardArray = whichDeck.slice(i, i+1);
      slicedCardObject = slicedCardArray.pop();
      wrongDeck.push(slicedCardObject);
      console.log(wrongDeck);
    }
  }
};

// clears all visible cards
var clearAllCards = function () {
  for (var i = 0; i < 7; i++) {
    $(".flashCard").eq(i).html("");
  }
};

// resets all the responses in deck (whichDeck.answered & whichDeck.correct)
var resetResponses = function () {
  for ( var i = 0; i < whichDeck.length; i++) {
    whichDeck[i].answered = false;
    whichDeck[i].correct = true;
  }
};

var updateDeckSymbols = function () {
  var cardInNext3 = Number($(".next3").children().attr("name"));
  var cardInBack3 = Number($(".back3").children().attr("name"));
  var toView = whichDeck.length - cardInNext3;
  var viewed = cardInBack3 - 1;

  if (isNaN(cardInNext3)) {
    $("#toView").text("0");
  } else {
    $("#toView").text(toView);
  }
  if (isNaN(cardInBack3)) {
    $("#viewed").text("0");
  } else {
    $("#viewed").text(viewed);
  }
};

var toggleDeckButton = function () {
  $(".generateWrongDeck").toggle();
  $(".generateOriginalDeck").toggle();
};

  var animationClasses = [".back3Animate", ".back2Animate", ".back1Animate", ".currentAnimate", ".next1Animate", ".next2Animate", ".next3Animate"];
  var animationsWithTwoNames = animationClasses.slice(1, 7);
  var animationNames = [
    ["back2Right", "back2Left"],
    ["back1Right", "back1Left"],
    ["currentRight", "currentLeft"],
    ["next1Right", "next1Left"],
    ["next2Right", "next2Left"]
  ];
var animateLeft = function () {

  for ( var i = 0; i < animationsWithTwoNames.length; i++) {
    $(animationsWithTwoNames[i]).css("animation-name", animationNames[i][1]);
  }

  for ( var j = 0; j < cardPositions.length; j++) {
    $(cardPositions[j]).addClass(animationClasses[j]);
  }
};

$(document).ready(function() {
  //function that generates html elements from deck object
  numberTheDeck(whichDeck);
  generateStart(whichDeck);
  updateDeckSymbols();
  $(".generateOriginalDeck").hide();

  //flip between front/back
  $(".currentCard").on("click", ".innerCard", function() {
    toggleFlip();
  });

  // cycle forward or back
  $(".next1").on("click", function() {
    flipToFront();
    cycleNext(whichDeck);
    updateDeckSymbols();
  });
  $(".back1").on("click", function() {
    flipToFront();
    cycleBack(whichDeck);
    updateDeckSymbols();
  });

  $("html").keydown(function(e) {
    if (e.keyCode == "37") { // Right Arrow
      flipToFront();
      cycleNext(whichDeck);
      updateDeckSymbols();
    }
    if (e.keyCode == "39") { // Left Arrow
      flipToFront();
      cycleBack(whichDeck);
      updateDeckSymbols();
    }
    if (e.keyCode == "38" || e.keyCode == "40") { // Up Arrow OR Down Arrow
      toggleFlip();
    }
  });

  $(".generateWrongDeck").on("click", function(){
    toggleDeckButton();
    pushToWrongDeck();
    whichDeck = wrongDeck;
    numberTheDeck(whichDeck);
    clearAllCards();
    resetResponses();
    generateStart(whichDeck);
    wrongDeck = [];
  });

  $(".generateOriginalDeck").on("click", function() {
    toggleDeckButton();
    whichDeck = deck;
    numberTheDeck(whichDeck);
    clearAllCards();
    resetResponses();
    generateStart(whichDeck);
  });

  //mark either right or wrong
  $(".cardContainer").on("click", ".wrongButton", function() {
    var cardInCurrent = Number($(".currentCard .innerCard").attr("name"));
    whichDeck[cardInCurrent - 1].answered = true;
    whichDeck[cardInCurrent - 1].correct = false;
    markWrong();
  });

  $(".cardContainer").on("click", ".correctButton", function() {
    var cardInCurrent = Number($(".currentCard .innerCard").attr("name"));
    whichDeck[cardInCurrent - 1].answered = true;
    whichDeck[cardInCurrent - 1].correct = true;
    markCorrect();
  });

});
